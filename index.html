<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Theodore Kluge</title>

    <!-- LOAD ALL OF THE SCRIPTS FIRST BECAUSE I CAN -->
	<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
	<script src="js/jquery.nicescroll.js"></script>
	<script src="js/lettering.min.js"></script>
	<script src="js/jquery.textillate.js"></script>
	<!-- AND THE STYLESHEETS TOO -->
	<link rel="stylesheet" href="css/spinsquare.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/fonts.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/villa7.css">
		
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script>
    $("html").niceScroll({ 
    	scrollspeed: 80,
    	mousescrollstep: 60,
    	cursorborder: '0px',
    	cursorcolor: "#444"
    });
    function checkScroll() {
   		var viewableOffset = $("#page-1").offset().top - $(window).scrollTop();
   		if (viewableOffset < -300) {
   			//show returnToTop
   			$('#btn-backtotop').css('visibility', 'visible')
   							   .addClass('fadeInUp')
   							   .removeClass('fadeOutDown');
   			$('#btn-page-2').addClass('fadeOutDown')
   							.removeClass('fadeInUp');

   			if (canLoadProjects == false) {
   				canLoadProjects = true;
   				new projectLoader();
		    	Backbone.history.start();
		    	console.log("Project list can now be loaded");
   			}
    		if (canShowProjectList) {
    			buildProjectList();
    			//showProjectList();
    			canShowProjectList = false;
    		}
    	} else {
    		//hide returnToTop
    		$('#btn-backtotop').addClass('fadeOutDown')
    						   .removeClass('fadeInUp');
    						   // .css('visibility', 'hidden');
    		$('#btn-page-2').addClass('fadeInUp')
    						.removeClass('fadeOutDown');
    	}
    }

  	$(document).ready(function(){
  		canShowProjectList = false;
  		canLoadProjects = false;
  		var projLoadInterval;

    	$('a[href*=#]:not([href=#])').click(function() {
		    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		      var target = $(this.hash);
		      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
		      if (target.length) {
		        $('html,body').animate({
		          scrollTop: target.offset().top
		        }, 1000);
		        return false;
		      }
		    }
	    });

    	$("h1.title").textillate({
    		in: {
                    effect: 'bounceInDown', //fadeinDownBig
                    delay: 50,
                    shuffle: true
                }
    	});
    	$("h3.subtitle").textillate({
    		in: {
                    effect: 'bounceInUp', //fadeInUpBig
                    delay: 50,
                    shuffle: true
                }
    	});

    	$(window).scroll(function() {
    		checkScroll();
    	});

    	var doit;
    	winHeight = $(window).height();
		winWidth = $(window).width();
    	$(window).resize(function() {
		  clearTimeout(doit);
		  doit = setTimeout(function() {
		    winHeight = $(window).height();
		    winWidth = $(window).width();
		    //clearInterval(projLoadInterval);
		    buildProjectList();
		    console.log('resized');
		}, 500);
		});

    	$('#btn-page-2').mouseover(function() {
			$('#msg-page-2').css('visibility', 'visible')
    							   .addClass('fadeInUp')
    							   .removeClass('fadeOutDown');
		}).mouseout(function() {
			$('#msg-page-2').addClass('fadeOutDown')
    							   .removeClass('fadeInUp')
    							   
		});
		$('.visit-link').mouseover(function() {
			$('.visit-link').css('visibility', 'visible')
    							   .addClass('fadeInUp')
    							   .removeClass('fadeOutDown');
		}).mouseout(function() {
			$('.visit-link').addClass('fadeOutDown')
    							   .removeClass('fadeInUp')
    							   
		});
	});

	</script>
  </head>
<body>
  
<section class="main-body fullscreen-body">
	<section class="page fullscreen" id="page-1">
		<div class="titlebox absolute-center">
			<h1 class="title" style="visibility:hidden">Theodore Kluge</h1>
			<h3 class="subtitle" style="visibility:hidden">Villa7_</h3>
		</div>
		<span class="btn-mouseover-message animated" id="msg-page-2">My Projects</span>
		<a href="#page-2" class="pagn downarrow button button-transparent animated fadeInUp" id="btn-page-2">
			<i class="fa fa-chevron-circle-down"></i>
		</a>
	</section>

	<section class="page fullscreen" id="page-2">
		<div class="loader">
			<span class="spinner"></span>
		</div>

			<!-- Backbone loads stuff in here -->
	</section>

	<!-- <span class="btn-mouseover-message animated" id="msg-backtotop">Top</span> -->
	<a href="#page-1" class="pagn uparrow button button-transparent animated" id="btn-backtotop">
		<i class="fa fa-chevron-circle-up"></i>
	</a>

</section>

<section class="fullscreen-overlay"></section>
<img class="background fullscreen-background" src="http://i.imgur.com/0P1Cryf.jpg" alt="background image" />

<script type="text/template" id="projects">
   	<div class="min-glass projectbox animated" id="project-<%= model.get('num') %>">
   	    <div class="thumbnail project-thumb" title="<%= model.get('title') %>">
   	        <div class="caption">
   	            <h4><%= model.get('title') %></h4>
   	            <!--<img src="<%= model.get('prev') %>" alt="preview image"></img>-->
   	            <p><%= model.get('desc') %></p>
   	            <a href="<%= model.get('url') %>"><span class="visit-link animated" onmouseover="$(this).addClass('pulse')" onmouseout="$(this).removeClass('pulse')">Visit -&gt </span></a>
   	        </div>
   	    </div>
    </div>
</script>

    <script src="js/underscore.min.js"></script>
    <script src="js/backbone.min.js"></script>
    <script type="text/javascript">
    	var stopNum = 0;
		var Data = Backbone.Model.extend({
		    defaults: {
		        title: '',
		        prev: '',
		        desc: '',
		        url: '',
		        num: ''
		    }
		});

		//Source spreadsheet
		var DataList = Backbone.Collection.extend({
		    model: Data,
		    url: 'https://spreadsheets.google.com/feeds/list/0ApDOZ6miZX5idE4yTmRVY1lNMVMzbkIzZlVveFNhd1E/od6/public/values?alt=json' 
		});

		//JSON reader thingy
		var AppView = Backbone.View.extend({
		    //set templates
		    project: _.template($('#projects').html()),
		    initialize: function () {
		    	$('.loader').fadeIn();
		    	console.info("Loading project list");
		        this.collection.on('reset', this.render, this);
		        c = this.collection;
		        this.collection.fetch({
		            success: function (model, response) {
		            	console.info('Loaded');
		                var feed = response['feed'];
		                var entry = feed['entry'];
		                var arr = [];
		                for (var i=0; i<entry.length; i++) {
		                    obj = {
		                        "title": entry[i].gsx$title.$t,
		                        "prev": entry[i].gsx$preview.$t,
		                        "desc": entry[i].gsx$description.$t,
		                        "url": 'http://' + entry[i].gsx$url.$t,
		                        "num": i
		                    };
		                    if (i == 0) {
		                    	//$('img.background').attr('src', entry[i].gsx$background.$t);
		                    }
		                    arr.push(obj);
		                    stopNum++;
		                }
		                $('.loader').fadeOut();
		                canShowProjectList = true;
		                console.log("Project list can now be displayed");
		                checkScroll();
		                c.reset(arr);
		            },
		            error: function () {
		            }
		        });
		    },

		    render: function () {
		        this.collection.each(this.list, this);
		    },

		    list: function (model) {
		        
		            $('#page-2').append(this.project({model: model}));
		        
		    }
		});

		var projectLoader = Backbone.Router.extend({
		    routes: {
		        '': 'start',
		    },
		    start: function () {
		        new AppView({collection: new DataList()});
		    }
		});

		function buildProjectList() {
			console.log("Building project list...");
			showProjectList();
		}

		function showProjectList() {
			i = 0;
			if (winWidth > 1600) { //4
				var glass_rows = 4;
			} else if (winWidth <= 1600 && winWidth > 1040) { //3
				var glass_rows = 3;
			} else if (winWidth <= 1040 && winWidth > 600) { //2
				var glass_rows = 2;
			} else { //1
				var glass_rows = 1;
			}

			var	glass_container_padding = 40, /*parseInt($('#page-2').css("padding-left")),*/
				glass_container_width = $('#page-2').width(),
				glass_currentRow = 1,
				glass_left = glass_container_padding,
				glass_top = glass_container_padding,
				glass_padding = 20,
				glass_total_padding = (glass_container_padding * 2) + (glass_padding * (glass_rows - 1)),
				glass_width = (glass_container_width - glass_total_padding) / glass_rows,
				glass_height,
				glass_prevs_top = [],
				glass_prevs_height = [],
				glass_prev_top = glass_top,
				glass_prev_height = glass_height,
				glass_prev_total = glass_container_padding,
				glass_margin = 40;

			console.log("Displaying project list");
			
			projLoadInterval = setInterval(function() {
				console.log("setting project-" + i);
				
				if (glass_currentRow > 1) {
					glass_prev_height = glass_prevs_height[i - glass_rows];
					glass_prev_top = glass_prevs_top[i - glass_rows];
					glass_prev_total = glass_prev_height + glass_prev_top;
					console.info(i + ": got prevHeight [" + (i - glass_rows) + "]: " + glass_prev_total + " from prevTop: " + glass_prev_top + " and prevHeight: " + glass_prev_height);
				}
				
				glass_top = glass_prev_total;

				$('#project-' + i).addClass('fadeInUp')
								  .css({
								  	'visibility': 'visible',
								  	'width': glass_width,
								  	'top': glass_top,
								  	'left': glass_left
								  });

				glass_height = $('#project-' + i).height();

				console.log(i + ": g_top: " + $('#project-' + i).css('top') + ", height: " + $('#project-' + i).height());

				glass_left += (glass_width + glass_padding);

				glass_prevs_top[i] = glass_top;
				glass_prevs_height[i] = glass_height;

				if (((i + 1) % glass_rows == 0 && i != 0) || glass_rows === 1) {
					glass_left = glass_container_padding; 
					glass_currentRow++;
					console.log("row: " + glass_currentRow);
				}

				i++;

				if (i >= stopNum) {
					clearInterval(projLoadInterval);
				}
			}, 100);
		}

    </script>

	<script src="js/instantclick.min.js" data-no-instant></script>
	<script data-no-instant>InstantClick.init();</script> 
	
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-48081162-1', 'villa7.github.io');
	  ga('send', 'pageview');

	</script>-

</body>
</html>